---
import { Image } from 'astro:assets';
import celineImage from '../assets/images/temoignages/celine.png';
import philippeImage from '../assets/images/temoignages/philippe.png';
// Les logos partenaires utilisent des chemins directs depuis /public/ car ce sont des fichiers statiques
// qui ne n√©cessitent pas d'optimisation et le marquee n√©cessite un rendu simple

const testimonials = [
  {
    id: 1,
    quote1: "Marc est quelqu'un de profond√©ment humain et impliqu√©. Tr√®s tr√®s curieux, il fait tout pour trouver des solutions innovantes et permettre √† tous de travailler vite et mieux. Fid√®le √† ses valeurs, il a besoin de croire en ce qu'il fait, d'adh√©rer √† un projet.",
    quote2: "Au sein de l'√©quipe Suivi p√©dagogique, Marc nous a beaucoup apport√©, notamment sur le plan des outils",
    quote3: "Merci Marc pour qui tu es et ce que tu peux apporter aux autres üí™",
    name: "C√©line Berthon",
    role: "Responsable de Campus, Wild Code School",
    image: celineImage,
    initials: "CB",
    bgColor: "bg-[#4F46E5]"
  },
  {
    id: 2,
    quote1: "Fondamentalement anim√© par une soif de partage, Marc est quelqu'un d'ouvert, avec qui il est toujours enrichissant de discuter.",
    quote2: "Au sein de l'√©quipe Suivi p√©dagogique - et √† O'clock en g√©n√©ral - Marc nous a beaucoup apport√©, notamment sur le plan des outils ; et de par son agilit√©. En effet, il n'est pas du genre √† s'√©panouir dans une organisation du travail contrainte par des process scl√©ros√©s ! Fid√®le √† ses valeurs, il a besoin de croire en ce qu'il fait, d'adh√©rer √† un projet - et quand il adh√®re, il s'implique enti√®rement.",
    quote3: "Merci Marc pour tes ouvertures d'horizons :)",
    name: "D√©borah Jean",
    role: "D√©veloppeuse web ind√©pendante",
    image: null,
    initials: "DJ",
    bgColor: "bg-[#F6A20E]"
  },
  {
    id: 3,
    quote1: "Marc est suffisamment p√©dagogue et patient pour arriver √† me faire traduire mes attentes, m'apprendre √† utiliser une base commune de travail, et cr√©er un site web r√©pondant parfaitement au cahier des charges. Chapeau l'artiste !",
    quote2: "Je suis press√© de d√©marrer la cr√©ation du deuxi√®me site. Merci Marc pour ton professionnalisme.",
    name: "Philippe G√©ant",
    role: "Pr√©sident, Endophyte",
    image: philippeImage,
    initials: "PG",
    bgColor: "bg-[#4F46E5]"
  },
  {
    id: 4,
    quote1: "Marc a rejoint notre √©quipe de d√©veloppement NoCode en janvier 2024 pour participer au d√©veloppement de plusieurs applications destin√©es √† nos clients internes et externes. Il ma√Ætrise bien les technologies WeWeb et Supabase, et a contribu√© efficacement √† la constitution de notre design system ainsi qu'au d√©veloppement de composants r√©utilisables.",
    quote2: "Marc d√©montre une bonne autonomie technique et s'adapte parfaitement au travail en full distanciel, ce qui facilite grandement la collaboration au quotidien. Sa capacit√© d'adaptation et sa ma√Ætrise des outils NoCode en font un d√©veloppeur comp√©tent pour des projets n√©cessitant rigueur technique et respect des standards √©tablis.",
    name: "Matthieu Arzel",
    role: "TechLead, PwC France",
    image: null,
    initials: "MA",
    bgColor: "bg-[#F6A20E]"
  },
  {
    id: 5,
    quote1: "C'est un r√©el plaisir de travailler quotidiennement avec Marc depuis 1 an. Rigoureux, force de proposition et √† l'√©coute, il est non seulement fiable et impliqu√© dans son travail mais c'est aussi une personne bienveillante, solaire et p√©dagogue.",
    quote2: "Ce qui rend notre collaboration aussi agr√©able qu'efficace : il comprend les enjeux UX/UI et sait trouver de bons compromis entre design et solutions technique. Je recommande √† 100% Marc !",
    name: "C√©line Sung",
    role: "UX/UI Designer, PwC France et Maghreb",
    image: null,
    initials: "CS",
    bgColor: "bg-[#4F46E5]"
  },
  {
    id: 6,
    quote1: "J'ai eu la chance de travailler avec Marc, et c'est une exp√©rience que je recommande √† 100 % ! Expert entre autres en nocode, il a su me transmettre de pr√©cieuses connaissances avec une p√©dagogie claire et efficace.",
    quote2: "Marc est une personne organis√©e, √† l'√©coute et toujours pr√™te √† aider. Sa capacit√© √† structurer les choses et √† expliquer avec simplicit√© rend le travail avec lui √† la fois fluide et enrichissant.",
    name: "Marie G.",
    role: "D√©veloppeuse web, Marie Garde EI",
    image: null,
    initials: "MG",
    bgColor: "bg-[#F6A20E]"
  },
  {
    id: 7,
    quote1: "Travailler avec toi a √©t√© une vraie opportunit√© d'√©changer sur des id√©es novatrices et bien structur√©es. Ta capacit√© √† g√©rer des projets avec clart√© et √† toujours proposer des solutions cr√©atives fait toute la diff√©rence.",
    quote2: "C'est un plaisir de collaborer avec quelqu'un d'aussi organis√© et inspirant. Au plaisir de retravailler ensemble !",
    name: "Joris L.",
    role: "D√©veloppeur, Joris Lefait EI",
    image: null,
    initials: "JL",
    bgColor: "bg-[#4F46E5]"
  },
  {
    id: 8,
    quote1: "Je cherchais une personne pour cr√©er mon nouveau site internet et j'ai eu la chance de rencontrer Marc qui m'a accompagn√©e tout au long de la r√©alisation de mon projet.",
    quote2: "Marc m'a non seulement aiguill√©e sur le contenu du site et de son design mais m'a aussi expliqu√© le fonctionnement de la plateforme pour que je sois autonome une fois termin√©. Un grand professionnalisme, une r√©activit√© et une cr√©ativit√© vraiment appr√©ciables. Je recommande vivement !",
    name: "Valentina Timpanaro",
    role: "Naturopathe",
    image: null,
    initials: "VT",
    bgColor: "bg-[#F6A20E]"
  },
  {
    id: 9,
    quote1: "Marc m'a aid√© √† terminer mon site internet pro, et a r√©ussi √† trouver comment le faire √©voluer et r√©soudre certains probl√®mes sp√©cifiques ; r√©elle volont√© de r√©soudre les challenges, je recommande !",
    name: "Vid√©aste-Photographe",
    role: "Freelance",
    image: null,
    initials: "VP",
    bgColor: "bg-[#4F46E5]"
  },
  {
    id: 10,
    quote1: "Mr CHARTON m'a aid√©e dans mon projet de site wordpress pour ma micro entreprise. Nous avons ensemble travaill√© sur le design, le r√©f√©rencement, et diverses fonctionnalit√©s.",
    quote2: "Mon site a √©t√© transform√© et mon objectif d'avoir plus de prospects via mon site a √©t√© atteint rapidement. Je recommande Mr CHARTON avec qui il est agr√©able de collaborer, il est patient et bon communiquant, m√™me lorsque les demandes ne sont pas formul√©es en termes techniques.",
    name: "Jessalynn CHOBY",
    role: "G√©rante",
    image: null,
    initials: "JC",
    bgColor: "bg-[#F6A20E]"
  }
];
---

<section class="section bg-gray-50 overflow-x-hidden">
  <div class="container mx-auto px-4">
    <div class="max-w-6xl mx-auto">
      <div class="text-center mb-12">
        <h2 class="text-4xl md:text-5xl font-bold mb-6 text-gray-900">Ils me font confiance</h2>
        <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">
          Petits business, centres de formation, startup en croissance, grandes entreprises. En tant que jury, formateur, consultant ou d√©veloppeur, ils m'ont fait confiance pour mettre en place des solutions innovantes et pour participer √† la qualit√© de leurs projets.
        </p>
      </div>
    </div>
  </div>
  
  <!-- Logos des entreprises - Bandeau d√©filant -->
  <div class="partners-marquee-wrapper w-full mb-16 py-8 overflow-hidden">
    <div class="partners-marquee flex items-center gap-8 md:gap-12">
      <!-- Premi√®re s√©rie de logos -->
      <img src="/images/partenaires/Logo_endophyte.jpg" alt="Endophyte" class="partner-logo-marquee" />
      <img src="/images/partenaires/epsi.png" alt="EPSI" class="partner-logo-marquee" />
      <img src="/images/partenaires/simplon.png" alt="SIMPLON.co" class="partner-logo-marquee" />
      <img src="/images/partenaires/oclock texte.png" alt="O'CLOCK" class="partner-logo-marquee" />
      <img src="/images/partenaires/alptis.png" alt="Alptis" class="partner-logo-marquee" />
      <img src="/images/partenaires/adrec.png" alt="ADREC" class="partner-logo-marquee" />
      <img src="/images/partenaires/Ereah.svg" alt="Ereah" class="partner-logo-marquee partner-logo-ereah" />
      <img src="/images/partenaires/PwC_Company_Logo.svg.png" alt="PwC" class="partner-logo-marquee" />
      <!-- Duplication pour effet de boucle infinie -->
      <img src="/images/partenaires/Logo_endophyte.jpg" alt="Endophyte" class="partner-logo-marquee" />
      <img src="/images/partenaires/epsi.png" alt="EPSI" class="partner-logo-marquee" />
      <img src="/images/partenaires/simplon.png" alt="SIMPLON.co" class="partner-logo-marquee" />
      <img src="/images/partenaires/oclock texte.png" alt="O'CLOCK" class="partner-logo-marquee" />
      <img src="/images/partenaires/alptis.png" alt="Alptis" class="partner-logo-marquee" />
      <img src="/images/partenaires/adrec.png" alt="ADREC" class="partner-logo-marquee" />
      <img src="/images/partenaires/Ereah.svg" alt="Ereah" class="partner-logo-marquee partner-logo-ereah" />
      <img src="/images/partenaires/PwC_Company_Logo.svg.png" alt="PwC" class="partner-logo-marquee" />
    </div>
  </div>
  
  <!-- Carrousel de t√©moignages - Pleine largeur -->
  <div class="testimonials-carousel-wrapper w-full py-8">
    <div class="relative">
      <!-- Conteneur avec overflow visible pour voir les cartes lat√©rales -->
      <div class="overflow-visible">
        <div id="testimonials-carousel" class="flex items-center gap-6 transition-transform duration-500 ease-in-out">
          {testimonials.map((testimonial, index) => (
            <div 
              class="testimonial-card flex-shrink-0 w-[480px] md:w-[576px] cursor-pointer transition-all duration-500"
              data-index={index}
            >
              <div class={`${testimonial.bgColor} rounded-2xl p-8 text-white shadow-xl flex flex-col h-full`}>
                <div class="mb-6">
                  <svg class="w-12 h-12 text-white/80" fill="currentColor" viewBox="0 0 32 32">
                    <path d="M10 8c-3.3 0-6 2.7-6 6v10h10V14H8c0-1.1.9-2 2-2V8zm16 0c-3.3 0-6 2.7-6 6v10h10V14h-6c0-1.1.9-2 2-2V8z"/>
                  </svg>
                </div>
                <div class="flex-1">
                  <p class="text-white/90 mb-4 text-lg leading-relaxed italic">
                    "{testimonial.quote1}"
                  </p>
                  {testimonial.quote2 && !testimonial.quote3 && (
                    <p class="text-white/90 mb-8 text-lg leading-relaxed italic">
                      "{testimonial.quote2}"
                    </p>
                  )}
                  {testimonial.quote2 && testimonial.quote3 && (
                    <p class="text-white/90 mb-4 text-lg leading-relaxed italic">
                      "{testimonial.quote2}"
                    </p>
                  )}
                  {testimonial.quote3 && (
                    <p class="text-white/90 mb-8 text-lg leading-relaxed italic">
                      "{testimonial.quote3}"
                    </p>
                  )}
                </div>
                <div class="flex items-center gap-4 pt-6 border-t border-white/20 mt-auto">
                  <div class="relative">
                    <div class="w-32 h-32 bg-white/20 rounded-full flex items-center justify-center overflow-hidden backdrop-blur-sm">
                      {testimonial.image ? (
                        <Image src={testimonial.image} alt={testimonial.name} class="w-28 h-28 object-cover rounded-full" />
                      ) : (
                        <div class="w-28 h-28 rounded-full bg-white/30 flex items-center justify-center">
                          <span class="text-3xl font-bold text-white">{testimonial.initials || testimonial.name.charAt(0)}</span>
                        </div>
                      )}
                    </div>
                  </div>
                  <div>
                    <p class="font-bold text-lg mb-1">{testimonial.name}</p>
                    <p class="text-white/80 text-base">{testimonial.role}</p>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
      
      <!-- Boutons de navigation -->
      <button id="prev-btn" class="absolute left-4 md:left-8 top-1/2 -translate-y-1/2 bg-white rounded-full p-3 shadow-lg hover:bg-gray-100 transition-colors z-20" aria-label="T√©moignage pr√©c√©dent">
        <svg class="w-6 h-6 text-[#4F46E5]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
      <button id="next-btn" class="absolute right-4 md:right-8 top-1/2 -translate-y-1/2 bg-white rounded-full p-3 shadow-lg hover:bg-gray-100 transition-colors z-20" aria-label="T√©moignage suivant">
        <svg class="w-6 h-6 text-[#4F46E5]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
      
      <!-- Indicateurs (dots) -->
      <div class="flex justify-center gap-2 mt-8">
        {testimonials.map((_, index) => (
          <button 
            class={`testimonial-dot w-3 h-3 rounded-full transition-all ${index === 0 ? 'bg-[#4F46E5]' : 'bg-gray-300'}`}
            data-index={index}
            aria-label={`Aller au t√©moignage ${index + 1}`}
          ></button>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
  .testimonial-card {
    opacity: 0.4;
    filter: blur(3px);
    transform: scale(0.85);
    pointer-events: auto;
  }
  
  .testimonial-card.active {
    opacity: 1;
    filter: blur(0);
    transform: scale(1);
    z-index: 10;
  }
  
  .testimonial-card:hover:not(.active) {
    opacity: 0.6;
    filter: blur(2px);
    transform: scale(0.9);
  }
  
  /* Carrousel de t√©moignages - Pleine largeur */
  .testimonials-carousel-wrapper {
    width: 100%;
    position: relative;
    overflow-x: hidden;
  }
  
  #testimonials-carousel {
    padding: 0 4rem;
  }
  
  @media (min-width: 768px) {
    #testimonials-carousel {
      padding: 0 6rem;
    }
  }
  
  /* Bandeau d√©filant des logos partenaires */
  .partners-marquee-wrapper {
    width: 100%;
    position: relative;
    overflow: hidden;
  }
  
  .partners-marquee {
    display: flex;
    align-items: center;
    gap: 2rem;
    animation: scroll 30s linear infinite;
    will-change: transform;
  }
  
  @media (min-width: 768px) {
    .partners-marquee {
      gap: 3rem;
    }
  }
  
  @keyframes scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }
  
  .partner-logo-marquee {
    height: 3.5rem;
    object-fit: contain;
    opacity: 0.5;
    filter: grayscale(100%);
    transition: all 0.3s ease;
    flex-shrink: 0;
  }
  
  .partner-logo-marquee:hover {
    opacity: 0.8;
    filter: grayscale(0%);
    transform: scale(1.1);
  }
  
  .partner-logo-ereah {
    filter: grayscale(100%) contrast(1.2) brightness(0.9);
    opacity: 0.7;
  }
  
  .partner-logo-ereah:hover {
    filter: grayscale(0%) brightness(0) saturate(100%) invert(48%) sepia(20%) saturate(1200%) hue-rotate(195deg) brightness(0.92) contrast(1.05);
    opacity: 1;
    transform: scale(1.1);
  }
  
  @media (min-width: 768px) {
    .partner-logo-marquee {
      height: 4.5rem;
    }
  }
</style>

<script>
  let currentIndex = 0;
  const testimonials = document.querySelectorAll('.testimonial-card');
  const carousel = document.getElementById('testimonials-carousel');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const dots = document.querySelectorAll('.testimonial-dot');
  
  const updateCarousel = () => {
    if (!carousel) return;
    
    // Calculer la position de translation pour centrer la carte active
    const cardWidth = testimonials[0]?.offsetWidth || 576; // w-[576px] = 576px par d√©faut
    const gap = 24; // gap-6 = 1.5rem = 24px
    const windowWidth = window.innerWidth;
    const translateX = currentIndex * (cardWidth + gap) - (windowWidth / 2 - cardWidth / 2);
    
    carousel.style.transform = `translateX(-${Math.max(0, translateX)}px)`;
    
    // Mettre √† jour les classes actives
    testimonials.forEach((card, index) => {
      if (index === currentIndex) {
        card.classList.add('active');
      } else {
        card.classList.remove('active');
      }
    });
    
    // Mettre √† jour les dots
    dots.forEach((dot, index) => {
      if (index === currentIndex) {
        dot.classList.remove('bg-gray-300');
        dot.classList.add('bg-[#4F46E5]');
      } else {
        dot.classList.remove('bg-[#4F46E5]');
        dot.classList.add('bg-gray-300');
      }
    });
  };
  
  const goToSlide = (index: number) => {
    if (index < 0 || index >= testimonials.length) return;
    currentIndex = index;
    updateCarousel();
  };
  
  const nextSlide = () => {
    currentIndex = (currentIndex + 1) % testimonials.length;
    updateCarousel();
  };
  
  const prevSlide = () => {
    currentIndex = (currentIndex - 1 + testimonials.length) % testimonials.length;
    updateCarousel();
  };
  
  if (prevBtn) prevBtn.addEventListener('click', prevSlide);
  if (nextBtn) nextBtn.addEventListener('click', nextSlide);
  
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => goToSlide(index));
  });
  
  // Permettre de cliquer sur les cartes lat√©rales pour naviguer
  testimonials.forEach((card, index) => {
    card.addEventListener('click', () => {
      if (index !== currentIndex) {
        goToSlide(index);
      }
    });
  });
  
  // Initialiser le carrousel apr√®s le chargement
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(updateCarousel, 100);
    });
  } else {
    setTimeout(updateCarousel, 100);
  }
  
  // R√©initialiser lors du redimensionnement
  let resizeTimeout: ReturnType<typeof setTimeout>;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(updateCarousel, 250);
  });
</script>
